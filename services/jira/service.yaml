# Jira fake — uses Airbyte source-jira connector for snapshot pulling.
#
# No custom connector code needed! The Airbyte adapter handles everything:
#   1. Runs `docker run airbyte/source-jira:latest discover` to find streams
#   2. Runs `docker run airbyte/source-jira:latest read` to pull records
#   3. Parses JSONL output, groups by stream, applies PII redaction
#   4. Saves as a DoubleAgent snapshot
#
# Usage:
#   export JIRA_API_TOKEN=your-api-token
#   export JIRA_DOMAIN=yourcompany.atlassian.net
#   export JIRA_EMAIL=you@company.com
#   doubleagent snapshot pull jira
#
# The fake server (when built) will serve these snapshots as a local Jira API.

name: jira
version: "0.1"
description: "Jira Cloud API fake (Airbyte-backed snapshot connector)"
docs: https://developer.atlassian.com/cloud/jira/platform/rest/v3/

server:
  command: ["uv", "run", "python", "-m", "doubleagent_sdk.generic_server"]

connector:
  type: airbyte
  image: airbyte/source-jira:latest

  # Which Airbyte streams to pull (subset of the 40+ Jira streams)
  streams:
    - projects
    - issues
    - users
    - sprints
    - boards
    - issue_comments
    - issue_fields
    - workflows

  # Map env vars → Airbyte connector config JSON paths
  # (Airbyte source-jira expects these in its config)
  config_env:
    JIRA_API_TOKEN: api_token
    JIRA_DOMAIN: domain
    JIRA_EMAIL: email

  # Map Airbyte stream names → DoubleAgent resource types
  # (keeps our naming consistent across services)
  stream_mapping:
    projects: projects
    issues: issues
    users: users
    sprints: sprints
    boards: boards
    issue_comments: comments
    issue_fields: fields
    workflows: workflows

  required_env:
    - JIRA_API_TOKEN
    - JIRA_DOMAIN
    - JIRA_EMAIL
